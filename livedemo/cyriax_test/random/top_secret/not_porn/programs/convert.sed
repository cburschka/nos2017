s|^.*tmtrans{\([^.}]*\)[^}]*}{\([^.}]*\)[^}]*}{.*trans *\(.\)\(.\)R.*}.*$|s/^\1:\\(.*\\)@\3\\(.\\)\\(.*\\)/\2:\\1\4@\\2\\3/;t loop|; t next
s|^.*tmtrans{\([^.}]*\)[^}]*}{\([^.}]*\)[^}]*}{.*trans *\(.\)\(.\)L.*}.*$|s/^\1:\\(.*\\)\\(.\\)@\3\\(.*\\)/\2:\\1@\\2\4\\3/;t loop|; t next
s|^.*tmstart{\([^.}]*\)[^}]*}.*$|s/^B*\\([^:B]*\\)B*$/\1:B@\\1B/\n:loop\ns/:@/:B@/g\ns/@$/@B/\np|; t next
s|^.*END-TM.*$|s/@//\ns/^[^:]*:B*\\([^B]*\\)B*$/\\1/|;t next
d
:next
